#nullable enable
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.Text.Json.Serialization;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;

namespace GovUk.Education.ExploreEducationStatistics.Common.ViewModels;

/// <summary>
/// Describes a problem that occurred whilst processing the request.
/// The format is based on RFC7807.
/// </summary>
public record ProblemDetailsViewModel
{
    /// <summary>
    /// A URI reference (RFC3986) that identifies the problem type. It should
    /// provide human-readable documentation for the problem type.
    /// </summary>
    [JsonPropertyOrder(-5)]
    [Newtonsoft.Json.JsonProperty(Order = -5)]
    [Required]
    public string? Type { get; set; }

    /// <summary>
    /// A short, human-readable summary of the problem type.
    /// </summary>
    [JsonPropertyOrder(-4)]
    [Newtonsoft.Json.JsonProperty(Order = -4)]
    [Required]
    public string? Title { get; set; }

    /// <summary>
    /// The HTTP status code generated by the origin server for the problem.
    /// </summary>
    [JsonPropertyOrder(-3)]
    [Newtonsoft.Json.JsonProperty(Order = -3)]
    [Required]
    public virtual int Status { get; set; } = StatusCodes.Status500InternalServerError;

    /// <summary>
    /// A human-readable explanation specific to the problem.
    /// </summary>
    [JsonPropertyOrder(-2)]
    [Newtonsoft.Json.JsonProperty(Order = -2)]
    public string? Detail { get; set; }

    /// <summary>
    /// A URI reference that identifies the specific occurrence of the problem.
    /// It may or may not yield further information about the problem.
    /// </summary>
    [JsonPropertyOrder(-1)]
    [Newtonsoft.Json.JsonProperty(Order = -1)]
    public string? Instance { get; set; }

    [JsonExtensionData]
    [Newtonsoft.Json.JsonExtensionData]
    public IDictionary<string, object?> Extensions { get; set; }
        = new Dictionary<string, object?>(StringComparer.Ordinal);

    public static ProblemDetailsViewModel Create(ProblemDetails problemDetails)
    {
        return new ProblemDetailsViewModel
        {
            Type = problemDetails.Type,
            Title = problemDetails.Title,
            Status = problemDetails.Status ?? StatusCodes.Status500InternalServerError,
            Detail = problemDetails.Detail,
            Instance = problemDetails.Instance,
            Extensions = problemDetails.Extensions
        };
    }
}
